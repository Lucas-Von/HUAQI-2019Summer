<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="financial_management.data.property.QuestionnaireMapper">

    <select id="hasQuest" resultType="boolean">
        select count(user_id) from questionnaire where user_id = #{userId}
    </select>

    <select id="getRecordTime" resultType="Date">
        select record_time as recordTime from questionnaire where user_id = #{userId}
    </select>

    <select id="getOriginAssets" resultType="Double">
        select coalesce(origin_assets, 0) as originAssets from questionnaire where user_id = #{userId}
    </select>

    <select id="getInvestPrefer" resultType="string">
        select invest_prefer from recommend where user_id = #{userId}
    </select>

    <insert id="insertQuest" parameterType="financial_management.parameter.property.QuestionnaireParam"
            useGeneratedKeys="true" keyProperty="id">
        insert into questionnaire(user_id, funds, saving, insurance, stocks, gold, bond, answer, record_time, origin_assets)
        values(#{userId}, #{funds}, #{saving},  #{insurance}, #{stocks}, #{gold}, #{bond}, #{answer}, #{recordTime}, #{originAssets})
    </insert>

    <insert id="updateQuest" parameterType="financial_management.parameter.property.QuestionnaireParam"
            useGeneratedKeys="true" keyProperty="id">
        update questionnaire
        set funds = #{funds}, saving = #{saving}, insurance = #{insurance}, stocks = #{stocks}, gold = #{gold}, bond = #{bond}, answer = #{answer}
        where user_id = #{userId}
    </insert>

    <insert id="insertQuestionnaireConfig" parameterType="financial_management.entity.property.QuestionnaireConfigPO"
            useGeneratedKeys="true" keyProperty="id">
        insert into recommend(user_id, invest_analysis_tag, volatility, yield, funds_rate, saving_rate, insurance_rate, investment_rate, stocks_rate, qdii_rate, gold_rate, bond_rate, total_volatility, total_yield, invest_prefer)
        values(#{userId}, #{invest_analysis_tag}, #{volatility}, #{yield}, #{insurance_rate}, #{funds_rate}, #{saving_rate}, #{investment_rate}, #{stocks_rate}, #{qdii_rate}, #{gold_rate}, #{bond_rate}, #{total_volatility}, #{total_yield}, #{total_risk_level})
    </insert>

</mapper>